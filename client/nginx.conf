# /client/nginx.conf

server {
    listen 80;
    server_name localhost;

    # The root directory where the React app's static files are stored.
    root /usr/share/nginx/html;
    index index.html;

    # Main location block for handling all requests.
    location / {
        # try_files is crucial for Single Page Applications (SPAs).
        # It checks for a file with the exact name ($uri),
        # then a directory with that name ($uri/),
        # and if neither exists, it falls back to serving /index.html.
        # This allows client-side routing (like React Router) to handle the URL.
        try_files $uri $uri/ /index.html;
    }

    # API Proxy: Forward requests starting with /api/ to the backend server.
    # This avoids CORS issues and simplifies client-side code.
    # The 'server' hostname will be resolved by Docker Compose.
    location /api/ {
        # The address of the backend service.
        # 'http://server:8080' assumes the backend service is named 'server'
        # in docker-compose.yml and runs on port 8080.
        proxy_pass http://server:8080;

        # Set headers to pass along client information to the backend.
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Optional: Add caching headers for static assets to improve performance.
    # Browsers will cache these files, reducing load times on subsequent visits.
    location ~* \.(?:jpg|jpeg|gif|png|ico|css|js)$ {
        expires 1y;
        add_header Cache-Control "public";
    }
}
